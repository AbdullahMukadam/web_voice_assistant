(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof module==="object"&&module.exports){module.exports=factory()}else{root.WebVoiceAssistant=factory()}})(typeof self!=="undefined"?self:this,(function(){var WebVoiceAssistant={};(function(){WebVoiceAssistant.extractPageContext=function(contextSize){const content=[];if(document.title){content.push(`Page Title: ${document.title}`)}const metaDesc=document.querySelector('meta[name="description"]');if(metaDesc){content.push(`Page Description: ${metaDesc.content}`)}const headings=document.querySelectorAll("h1, h2, h3, h4, h5, h6");headings.forEach((h=>{if(h.textContent.trim()&&!h.closest(".wva-container")){content.push(`${h.tagName}: ${h.textContent.trim()}`)}}));const paragraphs=document.querySelectorAll("p, li");paragraphs.forEach((p=>{if(p.textContent.trim().length>30&&!p.closest(".wva-container")){content.push(`Content: ${p.textContent.trim()}`)}}));const formElements=document.querySelectorAll("label, input[placeholder], textarea[placeholder]");formElements.forEach((el=>{if(el.textContent?.trim()||el.placeholder){content.push(`Form: ${el.textContent?.trim()||el.placeholder}`)}}));return content.join("\n").substring(0,contextSize||5e3)};if(typeof exports!=="undefined"){exports.extractPageContext=extractPageContext}})();(function(){WebVoiceAssistant.SpeechRecognition={setup:function({language:language,onResult:onResult}){const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;if(!SpeechRecognition)return null;const recognition=new SpeechRecognition;recognition.lang=language||"en-US";recognition.onresult=event=>{const transcript=event.results[0][0].transcript;onResult(transcript)};return recognition}};if(typeof module!=="undefined"&&module.exports){module.exports=WebVoiceAssistant.SpeechRecognition}})();(function(){const synthesis=window.speechSynthesis;WebVoiceAssistant.speak=function(text,{language:language,rate:rate}={}){return new Promise((resolve=>{let utterance=new SpeechSynthesisUtterance(text);utterance.rate=rate||.9;utterance.lang=language||"en-US";synthesis.speak(utterance);utterance.onend=()=>{resolve(false)}}))};WebVoiceAssistant.cancelSpeak=function(){synthesis.cancel()};if(typeof exports!=="undefined"){exports.speak=speak;exports.cancelSpeak=cancelSpeak}})();(function(){WebVoiceAssistant.UIManager=class{constructor(config,speak,startListening,stopListening,isListening,getCommand,cancelSpeak,speechConfig){this.assistant={};this.messages=[];this.speak=speak;this.startListening=startListening;this.stopListening=stopListening;this.isListening=isListening;this.getCommand=getCommand;this.isCancelBtnVisible=false;this.cancelSpeak=cancelSpeak;this.speechConfig=speechConfig||{};this.config={ButtonBackGroundColour:config.ButtonBackGroundColour||"black",svgColor:config.svgColor||"white",textColor:config.textColor||"white",position:config.position||"bottom-right",buttonSize:config.buttonSize||60,panelWidth:config.panelWidth||350,panelHeight:config.panelHeight||450,PanelBackgroundColor:config.PanelBackgroundColor||"rgb(24 24 27)",MessagesBackgroundColor:config.MessagesBackgroundColor||"rgb(24 24 27)"};this.injectStyles();this.createUI();this.bindEvents()}injectStyles(){if(document.getElementById("wva-styles"))return;const style=document.createElement("style");style.id="wva-styles";style.textContent=`\n            /* Main container */\n            .wva-container {\n                position: fixed;\n                z-index: 9999;\n                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            }\n            \n            /* Position classes */\n            .wva-position-bottom-right { bottom: 20px; right: 20px; }\n            .wva-position-bottom-left { bottom: 20px; left: 20px; }\n            .wva-position-top-right { top: 20px; right: 20px; }\n            .wva-position-top-left { top: 20px; left: 20px; }\n\n            /* Button styles */\n            .wva-button {\n                width: ${this.config.buttonSize}px;\n                height: ${this.config.buttonSize}px;\n                border-radius: 50%;\n                border: none;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n                position: relative;\n                background: ${this.config.ButtonBackGroundColour};\n                box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3),\n                           0 4px 16px rgba(118, 75, 162, 0.2),\n                           inset 0 1px 2px rgba(255, 255, 255, 0.1);\n                backdrop-filter: blur(10px);\n                overflow: hidden;\n            }\n            \n            .wva-button::before {\n                content: '';\n                position: absolute;\n                top: -50%;\n                left: -50%;\n                width: 200%;\n                height: 200%;\n               \n                transform: rotate(-45deg);\n                transition: all 0.6s;\n                opacity: 0;\n            }\n            \n            .wva-button:hover::before {\n                opacity: 1;\n                animation: wva-shimmer 1.5s ease-in-out;\n            }\n            \n            .wva-record-button{\n                width: ${this.config.buttonSize}px;\n                height: ${this.config.buttonSize}px;\n                border-radius: 50%;\n                border: none;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n                position: relative;\n                background: black;\n                box-shadow: 0 6px 24px rgba(102, 126, 234, 0.25),\n                           0 3px 12px rgba(118, 75, 162, 0.15),\n                           inset 0 1px 2px rgba(255, 255, 255, 0.1);\n                backdrop-filter: blur(10px);\n                overflow: hidden;\n            }\n            \n            .wva-record-button::before {\n                content: '';\n                position: absolute;\n                top: -50%;\n                left: -50%;\n                width: 200%;\n                height: 200%;\n                transform: rotate(-45deg);\n                transition: all 0.6s;\n                opacity: 0;\n            }\n\n            .btn-container{\n                width: 100%;\n                padding: 16px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                background: ${this.config.PanelBackgroundColor};\n                border-top: 1px solid rgba(102, 126, 234, 0.1);\n            }\n\n            .wva-button:hover {\n                transform: translateY(-3px) scale(1.05);\n                box-shadow: 0 12px 40px rgba(102, 126, 234, 0.4),\n                           0 6px 20px rgba(118, 75, 162, 0.3),\n                           inset 0 1px 2px rgba(255, 255, 255, 0.2);\n            }\n            \n            .wva-record-button:hover {\n                transform: translateY(-2px) scale(1.03);\n                box-shadow: 0 8px 32px rgba(102, 126, 234, 0.35),\n                           0 4px 16px rgba(118, 75, 162, 0.25);\n            }\n\n            .wva-record-button.listening {\n                background: linear-gradient(135deg, #ff6b6b, #ee5a24) !important;\n                box-shadow: 0 8px 32px rgba(255, 107, 107, 0.4),\n                           0 4px 16px rgba(238, 90, 36, 0.3),\n                           inset 0 1px 2px rgba(255, 255, 255, 0.1) !important;\n                animation: wva-pulse 1.5s infinite;\n            }\n\n            .wva-record-button.processing {\n                background: linear-gradient(135deg, #feca57, #ff9ff3) !important;\n                box-shadow: 0 8px 32px rgba(254, 202, 87, 0.4),\n                           0 4px 16px rgba(255, 159, 243, 0.3),\n                           inset 0 1px 2px rgba(255, 255, 255, 0.1) !important;\n                animation: wva-spin 1s linear infinite;\n            }\n\n            /* Icon styles */\n            .wva-icon {\n                width: 24px;\n                height: 24px;\n                fill: white;\n                filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));\n                transition: all 0.3s ease;\n            }\n            \n            .wva-button:hover .wva-icon,\n            .wva-record-button:hover .wva-icon {\n                transform: scale(1.1);\n                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));\n            }\n\n            .overlay-chat-panel{\n             height: ${this.config.panelHeight}px;\n             width: ${this.config.panelWidth}px;\n             position: absolute;\n             background-color:#edebe4;\n             display:none;\n             z-index:49;\n             opacity: 0;\n             transform: scale(0.95) translateY(-10px);\n             transition: opacity 0.3s ease, transform 0.3s ease;\n            }\n\n            .overlay-content-container{\n             height: 100%;\n             width: 100%;\n             display:flex;\n             flex-direction: column;\n             justify-content:space-between;\n             align-items:center;\n            }\n\n            .command{\n             height: 50%;\n             width: 100%;\n             display:flex;\n             justify-content:center;\n             align-items:center;\n            }\n\n            .gif{\n             width: 100%;\n             height:50%;\n             display:flex;\n             align-items: center;\n             justify-content:center;\n             flex-direction:column;\n             gap:5px;\n            }\n\n            .gif img{\n             height: 180px;\n             width: 180px;\n             z-index:60;\n             \n            }\n\n            .gif p{\n             font-size:14px;\n             text-align:center;\n             color: red;\n             font-weight: 400;\n             animation: bounce 2s infinite;\n            }\n\n            @keyframes bounce {\n             0%, 20%, 50%, 80%, 100% {\n                transform: translateY(0);\n                opacity: 1;\n              }\n            \t40% {\n                transform: translateY(-15px);\n              }\n            \t60% {\n                transform: translateY(-8px);\n              }\n            }\n\n            .command-text {\n              font-weight: 600;\n              font-size: 18px;\n              letter-spacing: 0.5px;\n              opacity: 1;\n              color:black;\n            }\n\n            .command-text.fade-in {\n                opacity: 0;\n                animation: fadeIn 2s ease-in-out forwards;\n            }\n\n            @keyframes fadeIn {\n                from {\n                    opacity: 0;\n                }\n                to {\n                    opacity: 1;\n                }\n            }\n\n            /* Chat panel */\n            .wva-chat-panel {\n                position: absolute;\n                width: ${this.config.panelWidth}px;\n                height: ${this.config.panelHeight}px;\n                background: ${this.config.PanelBackgroundColor};\n                backdrop-filter: blur(20px);\n                border-radius: 20px;\n                box-shadow: 0 24px 80px rgba(0, 0, 0, 0.12),\n                           0 12px 40px rgba(0, 0, 0, 0.08),\n                           0 6px 20px rgba(0, 0, 0, 0.04),\n                           inset 0 1px 2px rgba(255, 255, 255, 0.8);\n                display: none;\n                flex-direction: column;\n                overflow: hidden;\n                bottom: ${this.config.buttonSize+15}px;\n                ${this.config.position==="bottom-left"?"left: 0;":"right:0;"}\n                border: 1px solid rgba(255, 255, 255, 0.2);\n            }\n\n            .wva-chat-panel.active {\n                display: flex;\n                animation: wva-slideUp 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n            }\n\n            /* Chat header */\n            .wva-chat-header {\n                padding: 20px;\n                background:  ${this.config.PanelBackgroundColor};\n                color: ${this.config.textColor};\n                font-weight: 600;\n                position: relative;\n                font-size: 16px;\n                letter-spacing: 0.5px;\n            }\n            \n\n            .wva-close-btn {\n                position: absolute;\n                top: 16px;\n                right: 20px;\n                background: rgba(255, 255, 255, 0.1);\n                border: 1px solid rgba(255, 255, 255, 0.2);\n                border-radius: 50%;\n                width: 32px;\n                height: 32px;\n                color: ${this.config.textColor};\n                cursor: pointer;\n                font-size: 16px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.3s ease;\n                backdrop-filter: blur(10px);\n            }\n            \n            .wva-close-btn:hover {\n                background: rgba(255, 255, 255, 0.2);\n                transform: scale(1.1);\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n            }\n\n            /* Messages area */\n            .wva-messages {\n                flex: 1;\n                padding: 20px;\n                overflow-y: auto;\n                display: flex;\n                flex-direction: column;\n                gap: 16px;\n                background: ${this.config.MessagesBackgroundColor};\n            }\n            \n            .wva-messages::-webkit-scrollbar {\n                width: 6px;\n            }\n            \n            .wva-messages::-webkit-scrollbar-track {\n                background: rgba(102, 126, 234, 0.05);\n                border-radius: 3px;\n            }\n            \n            .wva-messages::-webkit-scrollbar-thumb {\n                background: linear-gradient(135deg, #667eea, #764ba2);\n                border-radius: 3px;\n            }\n\n            /* Message bubbles */\n            .wva-message {\n                max-width: 85%;\n                padding: 12px 16px;\n                border-radius: 18px;\n                font-size: 14px;\n                line-height: 1.5;\n                position: relative;\n                word-wrap: break-word;\n                animation: wva-messageSlide 0.3s ease-out;\n                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n                backdrop-filter: blur(10px);\n                background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);\n            }\n\n            .wva-message.user {\n                background:  rgb(9 9 11);\n                color: white;\n                align-self: flex-end;\n                border-bottom-right-radius: 6px;\n            }\n            \n            .wva-message.user::before {\n                content: '';\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);\n                border-radius: inherit;\n                pointer-events: none;\n            }\n\n            .wva-message.assistant {\n                background: rgba(45, 55, 72, 0.8);\n                border: 1px solid rgba(102, 126, 234, 0.2);\n                color: #e2e8f0;\n                align-self: flex-start;\n                border-bottom-left-radius: 6px;\n                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);\n            }\n\n            /* Status bar */\n            /* Actions container */\n            .wva-actions-container {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                padding: 16px 20px;\n                border-top: 1px solid rgba(102, 126, 234, 0.1);\n                background:  ${this.config.PanelBackgroundColor};\n                gap: 12px;\n            }\n\n            .wva-status {\n                font-size: 13px;\n                font-weight: 500;\n                color: #4a5568;\n                letter-spacing: 0.3px;\n                position: relative;\n                flex: 1;\n                text-align: left;\n            }\n            \n            .wva-status::before {\n                content: '';\n                position: absolute;\n                top: -16px;\n                left: 0;\n                width: 40px;\n                height: 2px;\n            }\n\n            /* Cancel Speech Button */\n            .cancel-speech-btn {\n                padding: 8px 16px;\n                border: 1px solid rgba(102, 126, 234, 0.2);\n                border-color: rgba(102, 126, 234, 0.3);\n                border-radius: 12px;\n                background: rgba(102, 126, 234, 0.1);\n                color: #667eea;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n                backdrop-filter: blur(10px);\n                letter-spacing: 0.3px;\n                text-transform: uppercase;\n                display: none;\n            }\n            \n            \n            .cancel-speech-btn:active {\n                transform: translateY(0);\n                box-shadow: 0 2px 6px rgba(102, 126, 234, 0.1);\n            }\n\n            .wva-status.listening {\n               \n                color: #e53e3e;\n                animation: wva-statusPulse 2s infinite;\n            }\n\n            .wva-status.processing {\n               \n                color: #d69e2e;\n                animation: wva-statusWave 1.5s infinite;\n            }\n\n            .wva-status.ready {\n                \n                color: #38a169;\n            }\n            \n           \n\n            /* Enhanced Animations */\n            @keyframes wva-pulse {\n                0%, 100% { \n                    transform: scale(1);\n                    box-shadow: 0 8px 32px rgba(255, 107, 107, 0.4),\n                               0 4px 16px rgba(238, 90, 36, 0.3),\n                               0 0 0 0 rgba(255, 107, 107, 0.7);\n                }\n                50% { \n                    transform: scale(1.05);\n                    box-shadow: 0 12px 40px rgba(255, 107, 107, 0.5),\n                               0 6px 20px rgba(238, 90, 36, 0.4),\n                               0 0 0 10px rgba(255, 107, 107, 0);\n                }\n            }\n\n            @keyframes wva-spin {\n                0% { transform: rotate(0deg); }\n                100% { transform: rotate(360deg); }\n            }\n            \n            @keyframes wva-shimmer {\n                0% { transform: translateX(-100%) rotate(-45deg); }\n                100% { transform: translateX(100%) rotate(-45deg); }\n            }\n\n            @keyframes wva-slideUp {\n                from { \n                    opacity: 0; \n                    transform: translateY(30px) scale(0.95);\n                    filter: blur(5px);\n                }\n                to { \n                    opacity: 1; \n                    transform: translateY(0) scale(1);\n                    filter: blur(0);\n                }\n            }\n            \n            @keyframes wva-messageSlide {\n                from {\n                    opacity: 0;\n                    transform: translateY(10px);\n                }\n                to {\n                    opacity: 1;\n                    transform: translateY(0);\n                }\n            }\n            \n            @keyframes wva-statusPulse {\n                0%, 100% { opacity: 1; }\n                50% { opacity: 0.7; }\n            }\n            \n            @keyframes wva-statusWave {\n                0%, 100% { transform: translateX(0); }\n                25% { transform: translateX(-2px); }\n                75% { transform: translateX(2px); }\n            }\n\n            /* Responsive design */\n            @media (max-width: 480px) {\n                .wva-chat-panel {\n                    width: calc(100vw - 40px);\n                    right: 20px !important;\n                    left: 20px !important;\n                    height: calc(100vh - 120px);\n                    max-height: ${this.config.panelHeight}px;\n                }\n                \n                .wva-messages {\n                    padding: 16px;\n                }\n                \n                .wva-chat-header {\n                    padding: 16px;\n                }\n            }\n            \n           \n        `;document.head.appendChild(style)}createUI(){this.container=document.createElement("div");this.container.className=`wva-container wva-position-${this.config.position}`;this.button=document.createElement("button");this.button.className="wva-button";this.button.title="Start voice interaction";this.button.innerHTML=`\n          <svg class="wva-icon" viewBox="0 0 24 24">\n  \x3c!-- Robot head (main body) --\x3e\n  <rect x="6" y="7" width="12" height="10" rx="2" ry="2" fill="none" stroke="${this.config.svgColor}" stroke-width="2"/>\n  \n  \x3c!-- Antenna --\x3e\n  <line x1="12" y1="3" x2="12" y2="7" stroke="${this.config.svgColor}" stroke-width="2"/>\n  <circle cx="12" cy="3" r="1" fill="${this.config.svgColor}"/>\n  \n  \x3c!-- Eyes --\x3e\n  <circle cx="9.5" cy="11" r="1.5" fill="${this.config.svgColor}"/>\n  <circle cx="14.5" cy="11" r="1.5" fill="${this.config.svgColor}"/>\n  \n  \x3c!-- Mouth/speaker grille --\x3e\n  <rect x="8" y="14" width="8" height="2" rx="1" fill="none" stroke="${this.config.svgColor}" stroke-width="1.5"/>\n  <line x1="9" y1="15" x2="15" y2="15" stroke="${this.config.svgColor}" stroke-width="0.5"/>\n  \n  \x3c!-- Side panels/ears --\x3e\n  <rect x="4" y="9" width="2" height="4" rx="1" fill="none" stroke="${this.config.svgColor}" stroke-width="1.5"/>\n  <rect x="18" y="9" width="2" height="4" rx="1" fill="none" stroke="${this.config.svgColor}" stroke-width="1.5"/>\n  \n  \x3c!-- Neck connector --\x3e\n  <rect x="10.5" y="17" width="3" height="2" fill="none" stroke="${this.config.svgColor}" stroke-width="1.5"/>\n</svg>\n        `;this.chatPanel=document.createElement("div");this.chatPanel.className="wva-chat-panel";this.chatPanel.innerHTML=`\n           <div class="overlay-chat-panel">\n            <div class="overlay-content-container">\n             <div class="command">\n             <p class="command-text"></p>\n            </div>\n            <div class="gif"> \n            <p>Listening..</p>\n              <img src="https://res.cloudinary.com/dhbs6k3ue/image/upload/v1749807636/yy3_a3p4as.gif" alt="gif" />\n            </div>\n            </div>\n           </div>\n            <div class="wva-chat-header">\n                Voice Assistant\n                <button class="wva-close-btn" title="Close chat">×</button>\n            </div>\n            <div class="wva-messages"></div>\n            <div class="wva-actions-container">\n                <div class="wva-status"></div>\n                <button class="cancel-speech-btn">Cancel Speech</button>\n            </div>\n            <div class="btn-container">\n             <button class="wva-record-button">\n             <svg class="wva-icon" viewBox="0 0 24 24">\n                <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/>\n            </svg>\n            </button>\n            </div>\n           \n        `;this.messagesEl=this.chatPanel.querySelector(".wva-messages");this.statusEl=this.chatPanel.querySelector(".wva-status");this.closeBtn=this.chatPanel.querySelector(".wva-close-btn");this.recordBtn=this.chatPanel.querySelector(".wva-record-button");this.cancelSpeechBtn=this.chatPanel.querySelector(".cancel-speech-btn");this.actionsContainer=this.chatPanel.querySelector(".wva-actions-container");this.chatPanelOverlay=this.chatPanel.querySelector(".overlay-chat-panel");this.commandtext=this.chatPanel.querySelector(".command-text");this.container.appendChild(this.button);this.container.appendChild(this.chatPanel);document.body.appendChild(this.container);this.addMessage("Hello! How can I help you today?","assistant")}bindEvents(){this.recordBtn.addEventListener("click",(()=>{if(!this.isListening()){this.chatPanelOverlay.style.display="block";requestAnimationFrame((()=>{this.chatPanelOverlay.style.opacity="1";this.chatPanelOverlay.style.transform="scale(1) translateY(0)"}));this.startListening();this.updateUI({isListening:true})}}));this.closeBtn.addEventListener("click",(()=>this.toggleChat(false)));this.cancelSpeechBtn.addEventListener("click",(()=>{this.cancelSpeak();this.updateCancelBtnStatus(false);this.updateUI({isReady:true});console.log("Speech cancelled")}));this.button.addEventListener("click",(()=>{this.toggleChat();this.updateCancelBtnStatus(true);this.speak("Hello! How can I help you today?",{language:this.speechConfig.language,rate:this.speechConfig.rate}).then((status=>{if(status===false){this.updateCancelBtnStatus(false);console.log(status)}}))}))}addMessage(text,sender){const messageEl=document.createElement("div");messageEl.className=`wva-message ${sender}`;messageEl.textContent=text;this.messagesEl.appendChild(messageEl);this.messagesEl.scrollTop=this.messagesEl.scrollHeight}updateStatus(text,state){this.statusEl.textContent=text;this.statusEl.className="wva-status"+(state?` ${state}`:"");this.actionsContainer.className="wva-actions-container"+(state?` ${state}`:"")}toggleChat(forceState){const shouldOpen=forceState!==undefined?forceState:!this.chatPanel.classList.contains("active");this.chatPanel.classList.toggle("active",shouldOpen)}setCommand(text){this.userCommand=text;this.commandtext.textContent=text;this.commandtext.classList.add("fade-in");setTimeout((()=>{this.chatPanelOverlay.style.opacity="0";this.chatPanelOverlay.style.transform="scale(0.95) translateY(-10px)";this.chatPanelOverlay.style.display="none";this.commandtext.textContent="";this.stopListening();this.updateUI({isProcessing:true})}),2e3)}updateCancelBtnStatus(shouldShow){this.isCancelBtnVisible=shouldShow;this.cancelSpeechBtn.style.display=shouldShow?"block":"none"}updateUI(state){this.recordBtn.className="wva-record-button";if(state.isListening){this.updateStatus("Listening...","listening")}else if(state.isProcessing){this.button.classList.add("processing");this.updateStatus("Processing...","processing")}else if(state.isReady){this.updateStatus("Asistant Responded","ready")}}};if(typeof module!=="undefined"&&module.exports){module.exports={UIManager:WebVoiceAssistant.UIManager}}})();(function(){WebVoiceAssistant.WebVoiceAssistant=class{constructor(options={}){this.speechConfig={language:options.language||"en-US",rate:options.rate||.9};this.contextConfig={contextSize:options.contextSize||5e3};this.recognition=WebVoiceAssistant.SpeechRecognition?WebVoiceAssistant.SpeechRecognition.setup({language:this.speechConfig.language,onResult:text=>this.processcommand(text)}):null;this.speak=WebVoiceAssistant.speak?WebVoiceAssistant.speak:function(){};this.cancelSpeak=WebVoiceAssistant.cancelSpeak?WebVoiceAssistant.cancelSpeak:function(){};this.ui=new WebVoiceAssistant.UIManager(options,this.speak,this.startListening,this.stopListening,(()=>this.listening),(()=>this.userCommand),this.cancelSpeak,this.speechConfig);this._userCommand="";this.listening=false;this.context=WebVoiceAssistant.extractPageContext(options.contextSize||5e3);this.aiConfig={geminiApiKey:options.geminiApiKey||(typeof window!=="undefined"?window.__WEBVOICEASSISTANT_CONFIG__?.geminiApiKey:undefined),model:options.model||"gemini-1.5-flash",maxTokens:options.maxTokens||200,temperature:options.temperature||.7};if(!this.recognition){alert("Speech recognition is not supported in this browser.")}}get userCommand(){return this._userCommand}generateAiResponse=async(command,Context)=>{if(!this.aiConfig.geminiApiKey){return"Please provide a Gemini API key to enable AI responses."}try{const response=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${this.aiConfig.model}:generateContent?key=${this.aiConfig.geminiApiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:`You are a helpful voice assistant. Current page context: ${Context}\n\nUser command: ${command}, also please dont include this ** in response`}]}],generationConfig:{temperature:this.aiConfig.temperature,maxOutputTokens:this.aiConfig.maxTokens}})});if(!response.ok){throw new Error(`Gemini API error: ${response.status}`)}const data=await response.json();if(data.candidates&&data.candidates[0]&&data.candidates[0].content){const parts=data.candidates[0].content.parts;if(parts&&parts[0]&&parts[0].text){return parts[0].text}}return"I received an empty response. Please try again."}catch(error){console.error("Gemini Error:",error);return"I encountered an error processing your request. Please try again."}};startListening=()=>{if(this.recognition){this.listening=true;this._userCommand="";this.recognition.start()}};stopListening=()=>{if(this.recognition){this.listening=false;this.recognition.stop()}};processcommand=async text=>{this._userCommand=text;this.ui.setCommand(text);this.ui.addMessage(text,"user");const context=WebVoiceAssistant.extractPageContext?WebVoiceAssistant.extractPageContext(this.contextConfig.contextSize||5e3):"";const value=await this.generateAiResponse(text,context);if(value){setTimeout((()=>{this.ui.updateUI({isReady:true});this.ui.addMessage(value,"assistant");this.speak(value,{language:this.speechConfig.language,rate:this.speechConfig.rate}).then((status=>{if(status===false){this.ui.updateCancelBtnStatus(status)}}));this.ui.updateCancelBtnStatus(true)}),1500)}}};if(typeof window!=="undefined"){window.WebVoiceAssistant=WebVoiceAssistant}})();if(typeof window!=="undefined"){window.WebVoiceAssistant=WebVoiceAssistant.WebVoiceAssistant}return WebVoiceAssistant.WebVoiceAssistant}));